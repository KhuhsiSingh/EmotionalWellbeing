<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wellness Companion MVP</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6; /* Light gray background */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh; /* Full viewport height */
        padding: 1rem;
        box-sizing: border-box;
      }
      .container {
        max-width: 900px; /* Max width for the app */
        width: 100%;
        background-color: #ffffff;
        border-radius: 1.5rem; /* More rounded corners */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Deeper shadow */
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 70vh; /* Minimum height for the app container */
      }
      .chat-area {
        flex-grow: 1;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        justify-content: flex-end; /* Messages appear from bottom */
        overflow-y: auto; /* Scrollable chat history */
        max-height: 400px; /* Limit chat height */
        background-color: #f9fafb; /* Slightly different background for chat */
      }
      .journal-area,
      .insights-area {
        padding: 1.5rem;
        display: none; /* Hidden by default */
        flex-direction: column;
        flex-grow: 1;
      }
      .message-box {
        background-color: #e0f2fe; /* Light blue for bot messages */
        padding: 1rem;
        border-radius: 1rem;
        margin-bottom: 0.75rem;
        align-self: flex-start; /* Bot messages align left */
        max-width: 80%; /* Limit message width */
      }
      .user-response {
        background-color: #d1fae5; /* Light green for user responses */
        padding: 0.75rem 1rem;
        border-radius: 1rem;
        margin-bottom: 0.75rem;
        align-self: flex-end; /* User responses align right */
        max-width: 70%;
      }
      textarea {
        min-height: 150px;
        resize: vertical;
        border-color: #e5e7eb;
        border-radius: 0.75rem;
        padding: 1rem;
        font-size: 0.95rem;
      }
      .button-primary {
        background-color: #10b981; /* Green primary button */
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: background-color 0.2s;
      }
      .button-primary:hover {
        background-color: #059669;
      }
      .button-secondary {
        background-color: #e5e7eb; /* Light gray secondary button */
        color: #4b5563;
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: background-color 0.2s;
      }
      .button-secondary:hover {
        background-color: #d1d5db;
      }
      .mood-button {
        background-color: #bfdbfe; /* Light blue for mood buttons */
        color: #1e40af;
        padding: 0.6rem 1.2rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: background-color 0.2s;
        flex-shrink: 0; /* Prevent shrinking */
      }
      .mood-button:hover {
        background-color: #93c5fd;
      }
      .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 2rem;
        border-radius: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        max-width: 600px;
        width: 90%;
        position: relative;
      }
      .close-button {
        color: #aaa;
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        font-weight: bold;
        cursor: pointer;
      }
      .close-button:hover,
      .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      .chat-messages {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: flex-end;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Main Chat Interface -->
      <div id="chatInterface" class="chat-area">
        <div id="chatMessages" class="chat-messages">
          <div class="message-box">
            <p class="font-semibold text-blue-800">Wellness Companion</p>
            <p id="botMessage" class="text-gray-700 mt-1">
              Hello! I'm your Wellness Companion. How are you feeling right now?
            </p>
          </div>
        </div>

        <!-- Mood Selection Buttons -->
        <div
          id="moodSelection"
          class="flex flex-wrap gap-3 mt-4 justify-center"
        >
          <button class="mood-button" data-mood="motivated">Motivated</button>
          <button class="mood-button" data-mood="annoyed">Annoyed</button>
          <button class="mood-button" data-mood="frustrated">Frustrated</button>
          <button class="mood-button" data-mood="overwhelmed">
            Overwhelmed
          </button>
          <button class="mood-button" data-mood="happy">Happy</button>
          <button class="mood-button" data-mood="excited">Excited</button>
        </div>

        <!-- Short Response Input (initially hidden) -->
        <div id="shortResponseInput" class="flex mt-4 hidden">
          <input
            type="text"
            id="shortResponseText"
            class="flex-grow border-2 border-gray-300 rounded-l-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Type your response..."
          />
          <button
            id="sendShortResponseButton"
            class="button-primary rounded-r-lg px-4"
          >
            Send
          </button>
        </div>

        <!-- Main Chat Action Buttons (initially hidden) -->
        <div
          id="chatButtons"
          class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 mt-4 hidden"
        >
          <button id="reflectButton" class="button-primary">
            Reflect & Journal
          </button>
          <button id="goodThanksButton" class="button-secondary">
            I'm good, thanks!
          </button>
          <button id="showInsightsButton" class="button-secondary">
            Show My Insights
          </button>
        </div>
      </div>

      <!-- Journaling Interface -->
      <div id="journalInterface" class="journal-area">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">
          Your Private Reflection Space
        </h2>
        <p class="text-gray-600 mb-4">
          What's on your mind today? (500 words max)
        </p>
        <textarea
          id="journalEntry"
          class="w-full border-2 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
          placeholder="Start writing here..."
        ></textarea>
        <p class="text-sm text-gray-500 mb-4">
          Word Count: <span id="wordCount">0</span> / 500
        </p>
        <div class="flex space-x-4">
          <button id="saveJournalButton" class="button-primary">
            Save Reflection
          </button>
          <button id="cancelJournalButton" class="button-secondary">
            Cancel
          </button>
        </div>
      </div>

      <!-- Personalized Insights Modal -->
      <div id="insightsModal" class="modal">
        <div class="modal-content">
          <span class="close-button" id="closeInsightsModal">&times;</span>
          <h2 class="text-2xl font-bold text-gray-800 mb-4">
            Your Weekly Reflection Insights
          </h2>
          <p class="text-gray-600 mb-4">
            Here's a look back at your emotional landscape this past week, based
            on your reflections and patterns.
          </p>
          <div id="insightsContent" class="prose max-w-none">
            <!-- Insights will be injected here -->
          </div>
          <p class="text-gray-500 text-sm mt-6">
            Remember, this is your private space for growth and understanding.
          </p>
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const chatInterface = document.getElementById("chatInterface");
      const chatMessages = document.getElementById("chatMessages"); // New element for messages
      const journalInterface = document.getElementById("journalInterface");
      const insightsModal = document.getElementById("insightsModal");
      const insightsContent = document.getElementById("insightsContent");
      const botMessage = document.getElementById("botMessage");
      const reflectButton = document.getElementById("reflectButton");
      const goodThanksButton = document.getElementById("goodThanksButton");
      const showInsightsButton = document.getElementById("showInsightsButton");
      const journalEntry = document.getElementById("journalEntry");
      const wordCountSpan = document.getElementById("wordCount");
      const saveJournalButton = document.getElementById("saveJournalButton");
      const cancelJournalButton = document.getElementById(
        "cancelJournalButton"
      );
      const closeInsightsModalButton =
        document.getElementById("closeInsightsModal");
      const chatButtons = document.getElementById("chatButtons");
      const moodSelection = document.getElementById("moodSelection");
      const moodButtons = document.querySelectorAll(".mood-button");
      const shortResponseInputDiv =
        document.getElementById("shortResponseInput"); // New
      const shortResponseText = document.getElementById("shortResponseText"); // New
      const sendShortResponseButton = document.getElementById(
        "sendShortResponseButton"
      ); // New

      // State Variables
      let journalEntries = []; // Stores all journal entries
      let currentQuestionIndex = 0;
      let selectedMoodForFollowUp = null; // To store the selected mood for follow-up questions

      // General questions (cycled after initial mood interaction)
      const generalQuestions = [
        "How are you feeling about your workload today?",
        "What's one thing that brought you joy recently?",
        "What's been a challenge you've faced this week?",
        "How are you managing your energy levels today?",
        "What's one small win you had today?",
        "Is there anything causing you stress right now?",
        "What's a feeling you've noticed within yourself today?",
        "How are you feeling about your collaborations with colleagues?",
        "What's one thing you're looking forward to this week?",
        "How are you prioritizing your well-being amidst your tasks?",
      ];

      // Specific follow-up questions based on initial mood selection
      const moodSpecificFollowUpQuestions = {
        motivated: [
          "That's great to hear! What's one specific thing that's making you feel motivated today?",
          "What kind of tasks are you finding most energizing right now?",
          "How do you plan to leverage this motivation to achieve your goals?",
        ],
        annoyed: [
          "I hear that. What specifically is causing you to feel annoyed?",
          "Can you pinpoint the situation or interaction that led to this feeling?",
          "What's one small thing you could do to address or diffuse this annoyance?",
        ],
        frustrated: [
          "Frustration can be tough. What's the root cause of this frustration?",
          "Is there a particular obstacle or task that's feeling overwhelming?",
          "What's one small step you could take to move past this feeling?",
        ],
        overwhelmed: [
          "It sounds like a lot is on your plate. What's contributing most to feeling overwhelmed?",
          "Are there specific tasks or responsibilities that feel particularly heavy?",
          "What's one thing you could delegate or postpone to lighten your load?",
        ],
        happy: [
          "Wonderful! What made you feel happy today?",
          "Can you describe a specific moment or interaction that brought you joy?",
          "How can you carry this positive energy into the rest of your day?",
        ],
        excited: [
          "That's fantastic! What are you excited about?",
          "Is there a new project, idea, or opportunity that's sparking this excitement?",
          "How do you plan to channel this excitement productively?",
        ],
      };

      const positiveKeywords = [
        "joy",
        "happy",
        "good",
        "accomplishment",
        "relief",
        "success",
        "calm",
        "peace",
        "excited",
        "grateful",
        "proud",
        "satisfied",
      ];
      const negativeKeywords = [
        "stress",
        "pressure",
        "deadline",
        "overwhelmed",
        "annoyed",
        "frustration",
        "challenge",
        "tired",
        "burnout",
        "difficult",
        "struggle",
        "demanding",
      ];

      // --- Functions ---

      // Function to add a bot message to the chat history
      function addBotMessageToChat(message) {
        const newMessageDiv = document.createElement("div");
        newMessageDiv.className = "message-box";
        newMessageDiv.innerHTML = `<p class="font-semibold text-blue-800">Wellness Companion</p><p class="text-gray-700 mt-1">${message}</p>`;
        chatMessages.appendChild(newMessageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
      }

      // Function to add a user response to the chat history
      function addUserMessageToChat(message) {
        const userResponseDiv = document.createElement("div");
        userResponseDiv.className = "user-response";
        userResponseDiv.textContent = message;
        chatMessages.appendChild(userResponseDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
      }

      // Function to switch to journaling interface
      function showJournaling() {
        chatInterface.style.display = "none";
        journalInterface.style.display = "flex";
        journalEntry.value = ""; // Clear previous entry
        updateWordCount();
      }

      // Function to switch back to chat interface
      function showChat() {
        journalInterface.style.display = "none";
        insightsModal.style.display = "none";
        chatInterface.style.display = "flex";
        // After initial mood interaction, subsequent returns to chat will cycle general questions
        currentQuestionIndex =
          (currentQuestionIndex + 1) % generalQuestions.length;
        addBotMessageToChat(generalQuestions[currentQuestionIndex]);
        moodSelection.classList.add("hidden"); // Ensure mood selection is hidden
        shortResponseInputDiv.classList.add("hidden"); // Ensure short response is hidden
        chatButtons.classList.remove("hidden"); // Ensure main buttons are visible
        selectedMoodForFollowUp = null; // Reset selected mood
      }

      // Function to update word count for journaling
      function updateWordCount() {
        const text = journalEntry.value.trim();
        const words = text.split(/\s+/).filter((word) => word.length > 0);
        const wordCount = words.length;
        wordCountSpan.textContent = wordCount;

        if (wordCount > 500) {
          journalEntry.value = words.slice(0, 500).join(" ");
          wordCountSpan.textContent = 500;
        }
      }

      // Function to save journal entry
      function saveJournalEntry() {
        const entryText = journalEntry.value.trim();
        if (entryText) {
          journalEntries.push({
            date: new Date().toISOString().split("T")[0], // YYYY-MM-DD
            text: entryText,
          });
          addBotMessageToChat(
            "Thanks for sharing your thoughts! I've saved your reflection."
          );
          console.log("Journal Entries:", journalEntries); // For debugging
        } else {
          addBotMessageToChat(
            "It looks like your journal entry is empty. Please write something before saving."
          );
        }
        showChat(); // Go back to chat after saving
      }

      // Function to generate and display insights
      function generateInsights() {
        if (journalEntries.length === 0) {
          insightsContent.innerHTML = `<p class="text-gray-700">You haven't written any journal entries yet. Start journaling to get personalized insights!</p>`;
          insightsModal.style.display = "flex";
          return;
        }

        let insightHtml = "";
        let commonThemes = {};
        let positiveCount = 0;
        let negativeCount = 0;

        journalEntries.forEach((entry) => {
          const words = entry.text.toLowerCase().split(/\W+/);
          words.forEach((word) => {
            // Simple keyword frequency for themes
            if (word.length > 3) {
              // Ignore very short words
              commonThemes[word] = (commonThemes[word] || 0) + 1;
            }

            // Sentiment analysis (very basic)
            if (positiveKeywords.includes(word)) {
              positiveCount++;
            } else if (negativeKeywords.includes(word)) {
              negativeCount++;
            }
          });
        });

        // Sort themes by frequency and pick top 3
        const sortedThemes = Object.entries(commonThemes)
          .sort(([, countA], [, countB]) => countB - countA)
          .slice(0, 3)
          .map(([word]) => `"${word}"`);

        insightHtml += `<h3 class="text-xl font-semibold text-gray-800 mb-2">Your Week at a Glance:</h3>`;
        insightHtml += `<ul class="list-disc list-inside mb-4 text-gray-700">`;
        if (sortedThemes.length > 0) {
          insightHtml += `<li><strong>Common Themes:</strong> This week, you frequently explored themes around ${sortedThemes.join(
            ", "
          )}.</li>`;
        } else {
          insightHtml += `<li><strong>Common Themes:</strong> No dominant themes identified this week.</li>`;
        }

        if (positiveCount > negativeCount * 1.5) {
          // Arbitrary threshold for "more positive"
          insightHtml += `<li><strong>Emotional Tone:</strong> Your reflections leaned towards a more positive and optimistic tone this week.</li>`;
        } else if (negativeCount > positiveCount * 1.5) {
          // Arbitrary threshold for "more negative"
          insightHtml += `<li><strong>Emotional Tone:</strong> You explored some challenging emotions this week, indicating areas for attention.</li>`;
        } else {
          insightHtml += `<li><strong>Emotional Tone:</strong> Your reflections showed a balanced mix of emotions this week.</li>`;
        }
        insightHtml += `</ul>`;

        insightHtml += `<h3 class="text-xl font-semibold text-gray-800 mb-2">A Closer Look:</h3>`;
        if (journalEntries.length > 0) {
          // Pick a recent entry or a summary of a few
          const lastEntry = journalEntries[journalEntries.length - 1];
          insightHtml += `<p class="mb-4 text-gray-700">For example, in your entry on ${
            lastEntry.date
          }, you wrote about: "${lastEntry.text.substring(0, 150)}..."</p>`;
        }

        insightHtml += `<h3 class="text-xl font-semibold text-gray-800 mb-2">Reflection Prompts for the Week Ahead:</h3>`;
        insightHtml += `<ul class="list-disc list-inside text-gray-700">`;
        insightHtml += `<li>What small step can you take this week to address a recurring theme you noticed?</li>`;
        insightHtml += `<li>How can you intentionally cultivate more moments of joy or calm in your day?</li>`;
        insightHtml += `</ul>`;

        insightsContent.innerHTML = insightHtml;
        insightsModal.style.display = "flex"; // Show the modal
      }

      // --- Event Listeners ---

      // Initial bot message on load
      window.onload = function () {
        addBotMessageToChat(
          "Hello! I'm your Wellness Companion. How are you feeling right now?"
        );
        moodSelection.classList.remove("hidden"); // Ensure mood selection is visible
        chatButtons.classList.add("hidden"); // Ensure main buttons are hidden
        shortResponseInputDiv.classList.add("hidden"); // Ensure short response is hidden
      };

      // Event listener for mood selection buttons
      moodButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          const selectedMood = event.target.dataset.mood;
          selectedMoodForFollowUp = selectedMood; // Store selected mood

          // Add user response to chat
          addUserMessageToChat(`I'm feeling ${selectedMood}.`);

          // Hide mood selection
          moodSelection.classList.add("hidden");

          // Get a random follow-up question for the selected mood
          const followUpQuestions =
            moodSpecificFollowUpQuestions[selectedMood] || [];
          let questionToAsk = generalQuestions[0]; // Default to a general question

          if (followUpQuestions.length > 0) {
            questionToAsk =
              followUpQuestions[
                Math.floor(Math.random() * followUpQuestions.length)
              ];
          }

          addBotMessageToChat(questionToAsk);

          // Show short response input
          shortResponseInputDiv.classList.remove("hidden");
          shortResponseText.focus(); // Focus on the input field
        });
      });

      // Event listener for sending short response
      sendShortResponseButton.addEventListener("click", () => {
        const response = shortResponseText.value.trim();
        if (response) {
          addUserMessageToChat(response);
          shortResponseText.value = ""; // Clear input

          // Hide short response input and show main chat buttons
          shortResponseInputDiv.classList.add("hidden");
          chatButtons.classList.remove("hidden");

          addBotMessageToChat(
            "Thanks for sharing that. Would you like to reflect more deeply or are you good for now?"
          );
        } else {
          addBotMessageToChat("Please type a response to continue.");
        }
      });

      // Allow sending short response with Enter key
      shortResponseText.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          sendShortResponseButton.click();
        }
      });

      reflectButton.addEventListener("click", showJournaling);
      goodThanksButton.addEventListener("click", () => {
        addBotMessageToChat(
          "Great to hear! Remember, I'm here if you need to reflect later."
        );
        // Simulate passive tracking by changing question after a short delay
        setTimeout(() => {
          showChat(); // Cycles to next general question
        }, 3000);
      });
      showInsightsButton.addEventListener("click", generateInsights);

      journalEntry.addEventListener("input", updateWordCount);
      saveJournalButton.addEventListener("click", saveJournalEntry);
      cancelJournalButton.addEventListener("click", () => {
        addBotMessageToChat(
          "No worries, your entry wasn't saved. I'm here when you're ready."
        );
        showChat();
      });
      closeInsightsModalButton.addEventListener("click", () => {
        insightsModal.style.display = "none";
      });

      // Close modal if clicked outside content
      window.addEventListener("click", (event) => {
        if (event.target == insightsModal) {
          insightsModal.style.display = "none";
        }
      });
    </script>
  </body>
</html>
